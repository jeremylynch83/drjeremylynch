<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, viewport-fit=cover"
        />
        <title>Book Appointment</title>

        <link rel="stylesheet" href="css/main.css" />
        <style>
            :root {
                --field-h: 48px;
                --field-px: 12px;
            }

            html,
            body {
                margin: 0;
                font-family: Arial, sans-serif;
                -webkit-text-size-adjust: 100%;
            }

            footer {
                background-color: #000;
                text-align: center;
                color: #fff;
            }
            footer .text-white {
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.35);
            }

            #book {
                background-image: url("img/footer.webp");
                min-height: 700px;
                background-repeat: no-repeat;
                background-size: cover;
                display: flex;
                justify-content: center;
                align-items: center;
            }
            #bookingContent {
                max-width: 520px;
                text-align: center;
                padding: 0 16px;
            }
            #bookingContent h1 {
                font-size: 28px;
                letter-spacing: 2px;
                margin: 0;
                color: #fff;
            }
            #bookingContent p {
                margin-top: 20px;
                font-size: 14px;
                color: #fff;
            }

            form {
                margin-top: 32px;
                font-size: 12px;
            }
            .form-group {
                margin-bottom: 5px;
            }

            /* Consistent, iOS-friendly form controls */
            input[type="text"],
            input[type="tel"],
            input[type="email"],
            select,
            textarea {
                width: 100%;
                box-sizing: border-box;
                background-color: #fff;
                border: 1px solid #ccc;
                border-radius: 0;
                font-size: 16px; /* avoids iOS zoom and evens heights */
                color: #000;
            }

            /* Same height for single-line controls */
            input[type="text"],
            input[type="tel"],
            input[type="email"],
            select {
                height: var(--field-h);
                padding: 0 var(--field-px);
                line-height: 1.25;
            }

            /* Textarea sizing */
            textarea {
                min-height: 100px;
                padding: var(--field-px);
                resize: vertical;
            }

            /* Remove native select skin and add chevron */
            select {
                appearance: none;
                -webkit-appearance: none;
                -moz-appearance: none;
                padding-right: 44px; /* space for chevron */
                background-repeat: no-repeat;
                background-position: right 12px center;
                background-size: 16px 16px;
                background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M5.5 7.5l4.5 5 4.5-5" fill="none" stroke="%23000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>');
                -webkit-text-fill-color: #000;
            }

            /* Placeholder style for the first option */
            select:required:invalid {
                color: #9ca3af;
                -webkit-text-fill-color: #9ca3af;
            }
            option {
                color: #000;
            }
            option[value=""] {
                color: #9ca3af;
            }

            button {
                background-color: #f1f1f1;
                border: none;
                padding: 12px 24px;
                cursor: pointer;
                font-size: 14px;
                margin-top: 32px;
            }
            button:disabled {
                opacity: 0.6;
                cursor: not-allowed;
            }

            #submitStatus {
                margin-top: 8px;
                min-height: 1em;
                font-size: 12px;
                color: #fff;
            }

            .footer-links {
                display: flex;
                justify-content: center;
                max-width: 500px;
                margin: auto;
                padding: 32px 0;
            }
            .footer-links div {
                flex: 1;
                text-align: center;
            }
            .footer-links a {
                color: #fff;
                font-size: 12px;
                text-decoration: none;
            }

            .footer-bottom {
                background-color: #151515;
                border-top: 2px solid #2a2a2a;
                padding: 20px;
                font-size: 12px;
                margin: 0;
            }

            .noscript-warning {
                background: #f44336;
                color: #fff;
                padding: 12px;
                text-align: center;
                font-size: 14px;
            }

            /* Spam controls: keep honeypot off-screen and inaccessible */
            .hp-field {
                position: absolute !important;
                left: -10000px !important;
                top: auto !important;
                width: 1px !important;
                height: 1px !important;
                overflow: hidden !important;
            }
        </style>
    </head>

    <body>
        <footer>
            <div id="book">
                <div id="bookingContent">
                    <h1>BOOK APPOINTMENT</h1>
                    <p>
                        To book an in-person or virtual consultation, or refer a
                        patient to Dr Lynch, enter the details below and our
                        practice management team will contact you to schedule
                        the appointment. Alternatively please email
                        <a href="mailto:enquiries@drjeremylynch.com"
                            >enquiries@drjeremylynch.com</a
                        >.
                    </p>

                    <form id="appointmentForm" novalidate>
                        <!-- Spam controls (server must enforce) -->
                        <input
                            type="hidden"
                            name="form_time"
                            id="form_time"
                            value=""
                        />
                        <div class="hp-field" aria-hidden="true">
                            <label for="company">Company</label>
                            <input
                                type="text"
                                id="company"
                                name="company"
                                tabindex="-1"
                                autocomplete="off"
                                inputmode="text"
                            />
                        </div>

                        <div class="form-group">
                            <input
                                type="text"
                                name="contact-name"
                                placeholder="Your name"
                                required
                                autocomplete="name"
                            />
                        </div>

                        <div class="form-group">
                            <input
                                type="tel"
                                name="contact-tel"
                                placeholder="Your telephone number"
                                required
                                autocomplete="tel"
                            />
                        </div>

                        <div class="form-group">
                            <input
                                type="email"
                                name="contact-email"
                                placeholder="Your email"
                                required
                                autocomplete="email"
                            />
                        </div>

                        <div class="form-group">
                            <select name="Topic" required>
                                <option value="" disabled selected>
                                    Topic of consultation
                                </option>
                                <option value="Aneurysm">Aneurysm</option>
                                <option value="Dural fistula">
                                    Dural fistula
                                </option>
                                <option value="AVM">AVM</option>
                                <option value="Spinal">Spinal</option>
                                <option value="Cerebral angiogram">
                                    Cerebral angiogram
                                </option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <select name="Insurance" required>
                                <option value="" disabled selected>
                                    Do you have medical insurance?
                                </option>
                                <option value="no">No</option>
                                <option value="bupa">BUPA</option>
                                <option value="AXA">AXA Health</option>
                                <option value="VitalityHealth">
                                    VitalityHealth
                                </option>
                                <option value="The Exeter">The Exeter</option>
                                <option
                                    value="WPA (Western Provident Association)"
                                >
                                    WPA (Western Provident Association)
                                </option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <textarea
                                name="extra-info"
                                placeholder="Additional information (optional)"
                            ></textarea>
                        </div>

                        <button id="submitBtn" type="submit" class="custom-btn">
                            BOOK CONSULTATION
                        </button>

                        <div id="submitStatus" aria-live="polite"></div>
                    </form>
                </div>
            </div>

            <div class="footer-links">
                <div><a href="General_Fees.html">FEES</a></div>
                <div>
                    <a href="General_Terms_and_Conditions.html"
                        >TERMS AND CONDITIONS</a
                    >
                </div>
                <div>
                    <a href="General_Cancellations.html">CANCELLATIONS</a>
                </div>
            </div>

            <div class="footer-bottom">
                ©
                <script>
                    document.write(new Date().getFullYear());
                </script>
                Dr&nbsp;Jeremy&nbsp;Lynch
            </div>
        </footer>

        <script>
            const appointmentForm = document.getElementById("appointmentForm");
            const submitBtn = document.getElementById("submitBtn");
            const statusEl = document.getElementById("submitStatus");
            const formTimeEl = document.getElementById("form_time");

            // Set a timestamp as soon as the page loads (time trap)
            if (formTimeEl) formTimeEl.value = Date.now();

            function fetchWithTimeout(resource, options = {}) {
                const { timeout = 20000 } = options;
                const controller = new AbortController();
                const id = setTimeout(() => controller.abort(), timeout);
                return fetch(resource, {
                    ...options,
                    signal: controller.signal,
                }).finally(() => clearTimeout(id));
            }

            appointmentForm.addEventListener("submit", function (event) {
                event.preventDefault();

                // Ensure timestamp exists even if JS loaded late
                if (formTimeEl && !formTimeEl.value)
                    formTimeEl.value = Date.now();

                // Client-side check for user experience only (server must enforce)
                if (!appointmentForm.checkValidity()) {
                    alert(
                        "Please fill in all parts of the form before submitting.",
                    );
                    return;
                }

                submitBtn.disabled = true;
                submitBtn.dataset.originalHtml = submitBtn.innerHTML;
                submitBtn.innerHTML =
                    '<i class="fa-solid fa-spinner fa-spin" aria-hidden="true"></i> Submitting…';
                appointmentForm.setAttribute("aria-busy", "true");
                statusEl.textContent = "Submitting your request…";

                const formData = new FormData(appointmentForm);

                fetchWithTimeout(
                    "https://www.radiologytemplates.org/send_email_ali",
                    {
                        method: "POST",
                        body: formData,
                        timeout: 20000,
                    },
                )
                    .then((response) => {
                        if (!response.ok)
                            throw new Error(
                                "Server returned an error response",
                            );
                        return response.text();
                    })
                    .then(() => {
                        document.getElementById("bookingContent").innerHTML = `
              <div style="text-align:center;">
                <i class="fa-solid fa-circle-check" style="font-size:48px; color:#fff;" aria-hidden="true"></i>
                <h3 style="margin-top:16px; color:#fff;">Thank you, your request has been submitted</h3>
              </div>`;
                    })
                    .catch((error) => {
                        console.error("Fetch error:", error);
                        submitBtn.disabled = false;
                        submitBtn.innerHTML =
                            submitBtn.dataset.originalHtml ||
                            "BOOK CONSULTATION";
                        appointmentForm.setAttribute("aria-busy", "false");
                        statusEl.textContent =
                            "Sorry, something went wrong. Please try again.";
                    });
            });
        </script>

        <noscript>
            <div class="noscript-warning">
                Please enable JavaScript to submit this form.
            </div>
        </noscript>
    </body>
</html>
